<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  <!-- namespace의 이름은 사용하려는 DAO의 풀패키지명과 동일하게 작성 -->
  <mapper namespace="com.winter.app.board.notice.NoticeDAO">
  	<resultMap type="NoticeVO" id="detailResult">
  		<id column="BOARD_NUM" property="boardNum"/>
  		<result column="BOARD_TITLE" property="boardTitle"/>
  		<result column="BOARD_WRITER" property="boardWriter"/>
  		<result column="BOARD_CONTENTS" property="boardContents"/>
  		<result column="BOARD_DATE" property="boardDate"/>
  		<result column="BOARD_HIT" property="boardHit"/>
  		<association property="boardFileVO" javaType="BoardFileVO">
  		<id column="FILE_NUM" property="fileNum"/>
  		<result column="ORI_NAME" property="oriName"/>
  		<result column="SAVE_NAME" property="saveName"/>	
  		</association>
  		
  	</resultMap>

   <select id="detail" parameterType="NoticeVO" resultMap="detailResult">
   	  SELECT * FROM notice n
	  LEFT JOIN noticefiles nf
	  USING(board_num)
	  WHERE board_num = #{boardNum}
   </select>
  
  <select id="totalCount" resultType="Long">
  		SELECT COUNT(BOARD_NUM) FROM NOTICE
  </select>
  
  	<!-- ID는 DAO의 메서드명과 동일하게 작성 -->
  	<select id="list" resultType="NoticeVO" parameterType="Pager">
	  	SELECT * FROM NOTICE 
	  	ORDER BY BOARD_NUM DESC
	  	limit #{startIndex}, #{endIndex}
  	</select>
  
  
  	<insert id="insert" parameterType="NoticeVO" useGeneratedKeys="true" keyProperty="boardNum">
  		INSERT INTO NOTICE 
  		(BOARD_NUM, BOARD_TITLE, BOARD_CONTENTS, BOARD_WRITER, BOARD_DATE, BOARD_HIT)
  		VALUES
  		(NULL, #{boardTitle}, #{boardContents}, #{boardWriter}, now(), 0)
  	</insert>
  	
  	<insert id="insertFile" parameterType="BoardFileVO">
  		INSERT INTO NOTICEFILES	
  		VALUES(NULL, #{oriName},#{saveName},#{boardNum})
  	</insert>
  	
  	<update id="update" parameterType="NoticeVO">
  		UPDATE NOTICE 
  		SET BOARD_TITLE = #{boardTitle},
  			BOARD_CONTENTS = #{boardContents}
  		WHERE BOARD_NUM = #{boardNum}	
  	</update>
  	<delete id="delete" parameterType="NoticeVO">
  		DELETE FROM NOTICE 
  		WHERE BOARD_NUM = #{boardNum}
  	</delete>
  </mapper>